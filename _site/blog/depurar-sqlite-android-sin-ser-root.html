<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Enrique Marcos">
  <meta name="description" content="TL;DR - Developer">
  <link type="text/plain" rel="author" href="/humans.txt">
  <link rel="shortcut icon" href="/favicon.ico">
  
     <title>Depurar SQLite en Android sin ser root | Enrique Marcos</title>
  


  <script type="text/javascript">
    if (navigator.appVersion.indexOf("Win")!=-1) {
        document.write('<link rel="stylesheet" type="text/css" media="all" href="fonts/equity-a.css" />');
    } else if (navigator.appVersion.indexOf("Mac")!=-1) {
        if (navigator.userAgent.match(/iPad/i) != null) {
            document.write('<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="/assets/fonts/equity-b.css" type="text/css" />');
            document.write('<link rel="stylesheet" media="only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2)" type="text/css" href="/assets/fonts/equity-a.css" />');
        } else {
            document.write('<link rel="stylesheet" type="text/css" media="all" href="/assets/fonts/equity-b.css" />');
        }
    } else {
        document.write('<link rel="stylesheet" type="text/css" media="all" href="/assets/fonts/equity-a.css" />');
    }
  </script>

  <link rel="stylesheet" type="text/css" media="all" href="/assets/fonts/equity-b.css">
  <link rel="stylesheet" type="text/css" media="all" href="/assets/css/styles.css">
  <link rel="stylesheet" type="text/css" media="all" href="/assets/fonts/1406-fonts.css">

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35072506-1']);
    _gaq.push(['_trackPageview']);
    
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
 </script>

  <script src="/assets/js/app.js"></script>

</head>
  <body>

    <div class="navigation">
  <a href="/">Blog</a>
  <a href="/art">Art</a>
  <a href="/projects">Projects</a>
  <a href="/about">About</a>
</div>
    <div class="content">
      <div id="doc">
        
          <topic class="small">
            Depurar SQLite en Android sin ser root <span class="extra-topic"></span>
            <div class="ddate">12.11.2013</div>
          </topic>
        
        <p>Si tenéis un nuevo y reluciente dispositivo Android que no queréis rootear
(un Nexus 5 por ejemplo) y sois desarrolladores, seguramente leer y escribir
en una base de datos <a href="http://www.sqlite.org/">SQLite</a> de una de vuestras aplicaciones sea tarea
común.
Lo siguiente son dos scripts para leer y escribir una base de datos sin
la necesidad de ser root.</p>

<h4 id="lectura">Lectura</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env bash</span>

<span class="nv">DEFAULT_APP</span><span class="o">=</span><span class="s2">"org.company.app"</span>
<span class="nv">DEFAULT_DB</span><span class="o">=</span><span class="s2">"cassandra.db"</span>
<span class="nv">DEFAULT_OUTPUT</span><span class="o">=</span><span class="s2">"/sdcard/Download/</span><span class="nv">$DEFAULT_DB</span><span class="s2">"</span>

<span class="nv">APP</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$DEFAULT_APP</span><span class="k">}</span>
<span class="nv">DB</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$DEFAULT_DB</span><span class="k">}</span>
<span class="nv">OUTPUT_DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">$DEFAULT_OUTPUT</span><span class="k">}</span>

<span class="nv">cmd</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> cat /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2"> &gt; </span><span class="nv">$OUTPUT_DIR</span><span class="s2">"</span>
adb -d shell <span class="s2">"</span><span class="nv">$cmd</span><span class="s2">"</span>
adb pull <span class="nv">$OUTPUT_DIR</span>

sqlite3 --version &amp;&gt; /dev/null
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq 0 <span class="o">]</span>; <span class="k">then
   </span>sqlite3 <span class="nv">$DB</span>
<span class="k">else
   </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DB</span><span class="s2"> ok"</span>
<span class="k">fi</span></code></pre></figure>

<p>Dale permisos de ejecución y cópialo en tu directorio bin personal. El script
lanza <code class="highlighter-rouge">adb</code> usando <code class="highlighter-rouge">run-as</code> bajo los permisos del nombre del paquete que
le pases como primer argumento (o el especificado por defecto en <code class="highlighter-rouge">DEFAULT_APP</code>).
De esta manera tiene permisos sobre la base de datos (<code class="highlighter-rouge">DEFAULT_DB</code> o
lo que especifiques como segundo argumento) para copiarla a un
directorio público (<code class="highlighter-rouge">DEFAULT_OUTPUT</code> o lo que especifiques como tercer argumento).
Luego con <code class="highlighter-rouge">adb pull</code> se copia la base de datos a tu disco duro.</p>

<p>Necesitarás <code class="highlighter-rouge">sqlite3</code> en tu ordenador para leer el fichero. Si lo tienes,
el script abre directamente el fichero recién descargado.</p>

<h4 id="escritura">Escritura</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env bash</span>

<span class="nv">DEFAULT_APP</span><span class="o">=</span><span class="s2">"org.company.app"</span>
<span class="nv">DEFAULT_DB</span><span class="o">=</span><span class="s2">"cassandra.db"</span>

<span class="nv">APP</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$DEFAULT_APP</span><span class="k">}</span>
<span class="nv">DB</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$DEFAULT_DB</span><span class="k">}</span>

<span class="nv">cmd1</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> chmod 666 /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2">"</span>
adb shell <span class="s2">"</span><span class="nv">$cmd1</span><span class="s2">"</span>
chmod 666 <span class="nv">$DB</span>
adb push <span class="nv">$DB</span> /data/data/<span class="nv">$APP</span>/databases/<span class="nv">$DB</span>

<span class="c"># Restore original permissions</span>
<span class="nv">cmd2</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> chmod 660 /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2">"</span>
adb shell <span class="s2">"</span><span class="nv">$cmd2</span><span class="s2">"</span></code></pre></figure>

<p>El script de escritura es parecido, usa <code class="highlighter-rouge">run-as</code> con el mismo
propósito. Aunque para escribir en el directorio de la aplicación
antes hay que cambiar los permisos. Una vez escrita la base
de datos, los permisos se restauran.</p>

<p>Nombra los scripts como <code class="highlighter-rouge">pull</code> y <code class="highlighter-rouge">push</code> y cuando
depures una base de datos puedes hacer <code class="highlighter-rouge">pull</code> para
abrirla, editarla de la manera usual, salir de sqlite3 (Ctrl-D) y
ejecutar <code class="highlighter-rouge">push</code> para escribir los cambios (todo esto suponiendo
que sobreescribas las variables por defecto del script).</p>


      </div>
    </div>

    <toc-topic>
  <a class="toc" href="mailto:enrmarc@gmail.com">Contact</a>&nbsp;&nbsp;
  <span class="bottom-p">·</span>&nbsp;&nbsp;<a class="toc" href="https://github.com/enrmarc">GitHub</a>&nbsp;&nbsp;
  <!--span class="bottom-p">·</span>&nbsp;&nbsp;<a class="toc" href=""><span class="bottom-l">the</span> wut?</a-->
  </toc-topic>
<div class="paramedics"></div>

    
  </body>
</html>