<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
     <title>Depurar SQLite en Android sin ser root | Enrique Marcos</title>
  

  <meta name="description" content="TL;DR - Programador">
  <meta name="author" content="Enrique Marcos">
  <meta name="copyright" content="© Copyright 2012 to Present">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="cleartype" content="on">

  <link type="text/plain" rel="author" href="/humans.txt">
  <link rel="stylesheet" href="/assets/css/app.css" type="text/css">
  <link rel="shortcut icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <!--[if (lt IE 9) & (!IEMobile)]>
  <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/css/fonts.css">

  

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35072506-1']);
    _gaq.push(['_trackPageview']);
    
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
 </script>

  <script src="/assets/js/app.js"></script>
</head>

  <body>
    <div id="cover_wrap" class="fadeInDown animated clearfix">
  <header id="masthead" class="clearfix">
    <hgroup class="intro">
      <h1>
        <a href="/" class="home">Enrique Marcos</a>
        <span>
          <!--a href="http://twitter.com/?" rel="me" target="_blank">@?</a-->
        </span>
      </h1>
    </hgroup>

    <nav id="cover">
      <ul id="headernav" class="list-none">
        <li>
          <a href="/" title="Posts" class="posts selected"><span>Posts</span></a>
        </li>
        <li>
          <a href="/repos/" title="Repos" class="about"><span>Repos</span></a>
        </li>
        <li>
          <a href="/art/" title="Arte" class="photos "><span>Arte</span></a>
        </li>
        <li>
          <a href="/about/" title="Acerca de" class="about"><span>Acerca de</span></a>
        </li>
      </ul>
    </nav>
  </header>
</div>
    <div id="site">
      
  <article id="post" class="is-post" role="main">

    <header class="entry-title">
      <h1>Depurar SQLite en Android sin ser root</h1>
    </header>

    <div class="entrecot">
      <small class="post-summary">Unos scripts</small>
    </div>

    <p>Si tenéis un nuevo y reluciente dispositivo Android que no queréis rootear<br />
(un Nexus 5 por ejemplo) y sois desarrolladores, seguramente leer y escribir<br />
en una base de datos <a href="http://www.sqlite.org/">SQLite</a> de una de vuestras aplicaciones sea tarea<br />
común.<br />
Lo siguiente son dos scripts para leer y escribir una base de datos sin<br />
la necesidad de ser root.</p>

<p>####Lectura</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env bash</span>

<span class="nv">DEFAULT_APP</span><span class="o">=</span><span class="s2">"org.company.app"</span>
<span class="nv">DEFAULT_DB</span><span class="o">=</span><span class="s2">"cassandra.db"</span>
<span class="nv">DEFAULT_OUTPUT</span><span class="o">=</span><span class="s2">"/sdcard/Download/</span><span class="nv">$DEFAULT_DB</span><span class="s2">"</span>

<span class="nv">APP</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$DEFAULT_APP</span><span class="k">}</span>
<span class="nv">DB</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$DEFAULT_DB</span><span class="k">}</span>
<span class="nv">OUTPUT_DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">$DEFAULT_OUTPUT</span><span class="k">}</span>

<span class="nv">cmd</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> cat /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2"> &gt; </span><span class="nv">$OUTPUT_DIR</span><span class="s2">"</span>
adb -d shell <span class="s2">"</span><span class="nv">$cmd</span><span class="s2">"</span>
adb pull <span class="nv">$OUTPUT_DIR</span>

sqlite3 --version &amp;&gt; /dev/null
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq 0 <span class="o">]</span>; <span class="k">then
   </span>sqlite3 <span class="nv">$DB</span>
<span class="k">else
   </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DB</span><span class="s2"> ok"</span>
<span class="k">fi</span></code></pre></figure>

<p>Dale permisos de ejecución y cópialo en tu directorio bin personal. El script<br />
lanza <code class="highlighter-rouge">adb</code> usando <code class="highlighter-rouge">run-as</code> bajo los permisos del nombre del paquete que<br />
le pases como primer argumento (o el especificado por defecto en <code class="highlighter-rouge">DEFAULT_APP</code>).<br />
De esta manera tiene permisos sobre la base de datos (<code class="highlighter-rouge">DEFAULT_DB</code> o<br />
lo que especifiques como segundo argumento) para copiarla a un<br />
directorio público (<code class="highlighter-rouge">DEFAULT_OUTPUT</code> o lo que especifiques como tercer argumento).<br />
Luego con <code class="highlighter-rouge">adb pull</code> se copia la base de datos a tu disco duro.</p>

<p>Necesitarás <code class="highlighter-rouge">sqlite3</code> en tu ordenador para leer el fichero. Si lo tienes,<br />
el script abre directamente el fichero recién descargado.</p>

<p>####Escritura</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env bash</span>

<span class="nv">DEFAULT_APP</span><span class="o">=</span><span class="s2">"org.company.app"</span>
<span class="nv">DEFAULT_DB</span><span class="o">=</span><span class="s2">"cassandra.db"</span>

<span class="nv">APP</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$DEFAULT_APP</span><span class="k">}</span>
<span class="nv">DB</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$DEFAULT_DB</span><span class="k">}</span>

<span class="nv">cmd1</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> chmod 666 /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2">"</span>
adb shell <span class="s2">"</span><span class="nv">$cmd1</span><span class="s2">"</span>
chmod 666 <span class="nv">$DB</span>
adb push <span class="nv">$DB</span> /data/data/<span class="nv">$APP</span>/databases/<span class="nv">$DB</span>

<span class="c"># Restore original permissions</span>
<span class="nv">cmd2</span><span class="o">=</span><span class="s2">"run-as </span><span class="nv">$APP</span><span class="s2"> chmod 660 /data/data/</span><span class="nv">$APP</span><span class="s2">/databases/</span><span class="nv">$DB</span><span class="s2">"</span>
adb shell <span class="s2">"</span><span class="nv">$cmd2</span><span class="s2">"</span></code></pre></figure>

<p>El script de escritura es parecido, usa <code class="highlighter-rouge">run-as</code> con el mismo<br />
propósito. Aunque para escribir en el directorio de la aplicación<br />
antes hay que cambiar los permisos. Una vez escrita la base<br />
de datos, los permisos se restauran.</p>

<p>Nombra los scripts como <code class="highlighter-rouge">pull</code> y <code class="highlighter-rouge">push</code> y cuando<br />
depures una base de datos puedes hacer <code class="highlighter-rouge">pull</code> para<br />
abrirla, editarla de la manera usual, salir de sqlite3 (Ctrl-D) y<br />
ejecutar <code class="highlighter-rouge">push</code> para escribir los cambios (todo esto suponiendo<br />
que sobreescribas las variables por defecto del script).</p>


    <small><time>Dec 11, 2013</time></small>
  </article>

      <footer id="darkfooter" class="clearfix">
  <div class="content_wrap">
    <div class="clearfix about-col">
        <img src="/assets/img/160.jpg">
        <p>
          Trabajo como desarrollador y actualmente <strike>Ruby, Android</strike>
          JavaScript paga mis facturas. Puedes <em>contactar</em>
          conmigo mediante:
          <a href="https://github.com/enrmarc">GitHub</a>&nbsp;&mdash;&nbsp;<a href="mailto:enrmarc@gmail.com">Correo</a>
        </p>
    </div>
  </div>
</footer>
    </div>

    
  </body>

</html>