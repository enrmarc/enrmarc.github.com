<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
     <title>Android, Axis2 y Ksoap2 | Enrique Marcos</title>
  

  <meta name="description" content="TL;DR - Programador">
  <meta name="author" content="Enrique Marcos">
  <meta name="copyright" content="© Copyright 2012 to Present">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="cleartype" content="on">

  <link type="text/plain" rel="author" href="/humans.txt">
  <link rel="stylesheet" href="/assets/css/app.css" type="text/css">
  <link rel="shortcut icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <!--[if (lt IE 9) & (!IEMobile)]>
  <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/css/fonts.css">

  

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35072506-1']);
    _gaq.push(['_trackPageview']);
    
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
 </script>

  <script src="/assets/js/app.js"></script>
</head>

  <body>
    <div id="cover_wrap" class="fadeInDown animated clearfix">
  <header id="masthead" class="clearfix">
    <hgroup class="intro">
      <h1>
        <a href="/" class="home">Enrique Marcos</a>
        <span>
          <!--a href="http://twitter.com/?" rel="me" target="_blank">@?</a-->
        </span>
      </h1>
    </hgroup>

    <nav id="cover">
      <ul id="headernav" class="list-none">
        <li>
          <a href="/" title="Posts" class="posts selected"><span>Posts</span></a>
        </li>
        <li>
          <a href="/repos/" title="Repos" class="about"><span>Repos</span></a>
        </li>
        <li>
          <a href="/art/" title="Arte" class="photos "><span>Arte</span></a>
        </li>
        <li>
          <a href="/about/" title="Acerca de" class="about"><span>Acerca de</span></a>
        </li>
      </ul>
    </nav>
  </header>
</div>
    <div id="site">
      
  <article id="post" class="is-post" role="main">

    <header class="entry-title">
      <h1>Android, Axis2 y Ksoap2</h1>
    </header>

    <div class="entrecot">
      <small class="post-summary">Enviar y recibir objetos complejos</small>
    </div>

    <p>Combinar en un mismo proyecto Android, Axis2 y SOAP es como el <em>Inferno</em> de Dante, sobre todo
si lo que quieres es enviar objetos complejos. Solo escribo una de tantas formas de hacerlo.
(Es necesario tener instalado y configurado <a href="http://axis.apache.org/axis2/java/core/">Axis2</a> e incluir la librería <a href="http://code.google.com/p/ksoap2-android/">Ksoap2</a> en el directorio <code>libs/</code> del proyecto Android ).</p>

<h4 id="servidor">Servidor</h4>
<p>La manera más rápida de desplegar un servicio web en Axis2 es creando un
<a href="http://axis.apache.org/axis2/java/core/docs/pojoguide.html">POJO</a> (Plain Old Java Object). El POJO utilizado para ilustrar el ejemplo
representará a una persona.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">entidades</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Persona</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">nombre</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">edad</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">peso</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Persona</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">Persona</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">,</span> <span class="kt">int</span> <span class="n">edad</span><span class="o">,</span> <span class="kt">double</span> <span class="n">peso</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">edad</span> <span class="o">=</span> <span class="n">edad</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">peso</span> <span class="o">=</span> <span class="n">peso</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setNombre</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setEdad</span><span class="o">(</span><span class="kt">int</span> <span class="n">edad</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">edad</span> <span class="o">=</span> <span class="n">edad</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setPeso</span><span class="o">(</span><span class="kt">double</span> <span class="n">peso</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">peso</span> <span class="o">=</span> <span class="n">peso</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">int</span>    <span class="nf">getEdad</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">edad</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getPeso</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">peso</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNombre</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">nombre</span><span class="o">;}</span>
<span class="o">}</span></code></pre></div>

<p>La clase que expondrá el servicio web será:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.entidades.Persona</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Service</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Persona</span> <span class="nf">test</span><span class="o">(</span><span class="n">Persona</span> <span class="n">persona</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Persona</span><span class="o">(</span><span class="n">persona</span><span class="o">.</span><span class="na">getNombre</span><span class="o">(),</span> <span class="n">persona</span><span class="o">.</span><span class="na">getEdad</span><span class="o">(),</span>
             <span class="n">persona</span><span class="o">.</span><span class="na">getPeso</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>El fichero de configuración <code>services.xml</code> indica la clase que representará el servicio web:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">&lt;service name=&quot;objetos&quot; scope=&quot;application&quot;&gt;</span>
<span class="go">   &lt;description&gt;Enviar y recibir objetos complejos&lt;/description&gt;</span>
<span class="go">   &lt;parameter name=&quot;ServiceClass&quot;&gt;org.Service&lt;/parameter&gt;</span>
<span class="go">   &lt;messageReceivers&gt;</span>
<span class="go">      &lt;messageReceiver</span>
<span class="go">         mep=&quot;http://www.w3.org/2004/08/wsdl/in-only&quot;</span>
<span class="go">         class=&quot;org.apache.axis2.rpc.receivers.RPCInOnlyMessageReceiver&quot;/&gt;</span>
<span class="go">      &lt;messageReceiver</span>
<span class="go">         mep=&quot;http://www.w3.org/2004/08/wsdl/in-out&quot;</span>
<span class="go">         class=&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot;/&gt;</span>
<span class="go">   &lt;/messageReceivers&gt;</span>
<span class="go">&lt;/service&gt;</span></code></pre></div>

<p>La estructura de directorios en el servidor queda así:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">objetos/</span>
<span class="go">├── META-INF</span>
<span class="go">│   └── services.xml</span>
<span class="go">└── src</span>
<span class="go">    └── org</span>
<span class="go">        ├── entidades</span>
<span class="go">        │   └── Persona.java</span>
<span class="go">        └── Service.java</span></code></pre></div>

<h4 id="cliente">Cliente</h4>
<p>El código Android utiliza la librería <a href="http://code.google.com/p/ksoap2-android/">Ksoap2</a> para poder gestionar los mensajes
<a href="http://en.wikipedia.org/wiki/SOAP">SOAP</a>. Para que un objeto complejo pueda ser enviado en un mensaje SOAP debe
implementar la interfaz <code>KvmSerializable</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">objetos</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.KvmSerializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.PropertyInfo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Persona</span> <span class="kd">implements</span> <span class="n">KvmSerializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">nombre</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">edad</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">peso</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Persona</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">Persona</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">,</span> <span class="kt">int</span> <span class="n">edad</span><span class="o">,</span> <span class="kt">double</span> <span class="n">peso</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">edad</span> <span class="o">=</span> <span class="n">edad</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">peso</span> <span class="o">=</span> <span class="n">peso</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNombre</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEdad</span><span class="o">(</span><span class="kt">int</span> <span class="n">edad</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">edad</span> <span class="o">=</span> <span class="n">edad</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPeso</span><span class="o">(</span><span class="kt">double</span> <span class="n">peso</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">peso</span> <span class="o">=</span> <span class="n">peso</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNombre</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">nombre</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getEdad</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">edad</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getPeso</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">peso</span><span class="o">;}</span>

    <span class="cm">/* Ksoap */</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getProperty</span><span class="o">(</span><span class="kt">int</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="k">return</span> <span class="n">nombre</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="k">return</span> <span class="n">edad</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="k">return</span> <span class="n">peso</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPropertyCount</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="mi">3</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getPropertyInfo</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">Hashtable</span> <span class="n">arg1</span><span class="o">,</span>
            <span class="n">PropertyInfo</span> <span class="n">propertyInfo</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;nombre&quot;</span><span class="o">;</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">PropertyInfo</span><span class="o">.</span><span class="na">STRING_CLASS</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;edad&quot;</span><span class="o">;</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">PropertyInfo</span><span class="o">.</span><span class="na">INTEGER_CLASS</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;peso&quot;</span><span class="o">;</span>
                <span class="n">propertyInfo</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">this</span><span class="o">.</span><span class="na">edad</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">this</span><span class="o">.</span><span class="na">peso</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Además, para los tipo <code>double</code> es necesario implementar la interfaz <code>Marshal</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">objetos</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.Marshal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.PropertyInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.SoapSerializationEnvelope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xmlpull.v1.XmlPullParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xmlpull.v1.XmlPullParserException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xmlpull.v1.XmlSerializer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MarshalDouble</span> <span class="kd">implements</span> <span class="n">Marshal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">readInstance</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">,</span> <span class="n">String</span> <span class="n">namespace</span><span class="o">,</span>
           <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">PropertyInfo</span> <span class="n">expected</span><span class="o">)</span>
           <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XmlPullParserException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">nextText</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">SoapSerializationEnvelope</span> <span class="n">cm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">cm</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="n">cm</span><span class="o">.</span><span class="na">xsd</span><span class="o">,</span> <span class="s">&quot;double&quot;</span><span class="o">,</span> <span class="n">Double</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeInstance</span><span class="o">(</span><span class="n">XmlSerializer</span> <span class="n">writer</span><span class="o">,</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">)</span>
           <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Y por último la Activity:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">objetos</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.ksoap2.SoapEnvelope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.SoapObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.SoapPrimitive</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.SoapSerializationEnvelope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.transport.HttpTransportSE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.transport.HttpTransportSE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.serialization.PropertyInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ksoap2.SoapFault</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.AsyncTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View.OnClickListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.ProgressDialog</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">NAMESPACE</span> <span class="o">=</span> <span class="s">&quot;http://org&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">TARGET_NAMESPACE</span> <span class="o">=</span> <span class="s">&quot;http://entidades.org/xsd&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">URL</span> <span class="o">=</span> <span class="s">&quot;http://10.0.2.2:8080/axis2/services/objetos/&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">METHOD_NAME</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Button</span> <span class="n">send</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">EditText</span> <span class="n">etNombre</span><span class="o">,</span> <span class="n">etEdad</span><span class="o">,</span> <span class="n">etPeso</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">tvNombre</span><span class="o">,</span> <span class="n">tvEdad</span><span class="o">,</span> <span class="n">tvPeso</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
        <span class="n">etNombre</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">etNombre</span><span class="o">);</span>
        <span class="n">etEdad</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">etEdad</span><span class="o">);</span>
        <span class="n">etPeso</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">etPeso</span><span class="o">);</span>

        <span class="n">tvNombre</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvNombre</span><span class="o">);</span>
        <span class="n">tvEdad</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvEdad</span><span class="o">);</span>
        <span class="n">tvPeso</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvPeso</span><span class="o">);</span>

        <span class="n">send</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">send</span><span class="o">);</span>
        <span class="n">send</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">new</span> <span class="nf">Test</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span>
                    <span class="k">new</span> <span class="nf">Persona</span><span class="o">(</span>
                        <span class="n">etNombre</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span>
                        <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">etEdad</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">()),</span>
                        <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">etPeso</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">())));</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="n">AsyncTask</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">ProgressDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ProgressDialog</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPreExecute</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">dialog</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">&quot;Enviando ...&quot;</span><span class="o">);</span>
            <span class="n">dialog</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">protected</span> <span class="n">Persona</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Persona</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">enviar</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">Persona</span> <span class="n">persona</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">dialog</span><span class="o">.</span><span class="na">isShowing</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">dialog</span><span class="o">.</span><span class="na">dismiss</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">persona</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tvNombre</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">persona</span><span class="o">.</span><span class="na">getNombre</span><span class="o">());</span>
                <span class="n">tvEdad</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">persona</span><span class="o">.</span><span class="na">getEdad</span><span class="o">()));</span>
                <span class="n">tvPeso</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">Double</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">persona</span><span class="o">.</span><span class="na">getPeso</span><span class="o">()));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Persona</span> <span class="nf">enviar</span><span class="o">(</span><span class="n">Persona</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">HttpTransportSE</span> <span class="n">transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HttpTransportSE</span><span class="o">(</span><span class="n">URL</span><span class="o">);</span>
        <span class="n">SoapObject</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SoapObject</span><span class="o">(</span><span class="n">NAMESPACE</span><span class="o">,</span> <span class="n">METHOD_NAME</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">addProperty</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">SoapSerializationEnvelope</span> <span class="n">envelope</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">SoapSerializationEnvelope</span><span class="o">(</span><span class="n">SoapEnvelope</span><span class="o">.</span><span class="na">VER11</span><span class="o">);</span>
        <span class="n">envelope</span><span class="o">.</span><span class="na">dotNet</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">envelope</span><span class="o">.</span><span class="na">setOutputSoapObject</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">envelope</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span>
            <span class="n">TARGET_NAMESPACE</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="n">MarshalDouble</span> <span class="n">md</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MarshalDouble</span><span class="o">();</span>
        <span class="n">md</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">transport</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">NAMESPACE</span> <span class="o">+</span> <span class="n">METHOD_NAME</span><span class="o">,</span> <span class="n">envelope</span><span class="o">);</span>
            <span class="n">Persona</span> <span class="n">persona</span> <span class="o">=</span> <span class="o">(</span><span class="n">Persona</span><span class="o">)</span><span class="n">envelope</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">persona</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>


    <small><time>Apr 13, 2012</time></small>
  </article>

      <footer id="darkfooter" class="clearfix">
  <div class="content_wrap">
    <div class="clearfix about-col">
        <img src="/assets/img/160.jpg">
        <p>
          Trabajo como desarrollador y actualmente <strike>Ruby, Android</strike>
          JavaScript paga mis facturas. Puedes <em>contactar</em>
          conmigo mediante:
          <a href="https://github.com/enrmarc">GitHub</a>&nbsp;&mdash;&nbsp;<a href="mailto:enrmarc@gmail.com">Correo</a>
        </p>
    </div>
  </div>
</footer>
    </div>

    
  </body>

</html>